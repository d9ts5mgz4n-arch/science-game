<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Ù…ØºØ§Ù…Ø±Ø© ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„Ø¹Ù„ÙˆÙ…</title>
<style>
  :root{--bg:#0b1220;--panel:#0f1724;--accent:#2dd4bf;--text:#e6eef3}
  html,body{height:100%;margin:0;font-family:Tahoma,Arial}
  body{background:linear-gradient(180deg,#061021 0%, #0b1730 100%);color:var(--text);display:flex;flex-direction:column;align-items:center}
  .header{width:100%;padding:10px 14px;box-sizing:border-box;display:flex;align-items:center;justify-content:space-between}
  .title{font-size:18px;font-weight:700}
  .container{width:100%;max-width:900px;padding:10px;box-sizing:border-box}
  .game-area{background:radial-gradient(circle at 10% 10%, rgba(255,255,255,0.03), transparent 20%), var(--panel); border-radius:12px;overflow:hidden;position:relative}
  canvas{display:block;width:100%;height:auto;background:linear-gradient(#082033,#061522)}
  .ui-row{display:flex;gap:8px;padding:10px;align-items:center}
  .button{background:rgba(255,255,255,0.06);padding:8px 12px;border-radius:8px;color:var(--text);border:1px solid rgba(255,255,255,0.04);font-weight:600}
  .badge{background:rgba(255,255,255,0.03);padding:6px 8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04)}
  .controls{position:absolute;right:10px;bottom:10px;display:flex;flex-direction:column;gap:8px}
  .dpad{width:120px;height:120px;background:rgba(0,0,0,0.18);border-radius:12px;padding:8px;display:grid;grid-template-columns:1fr 1fr 1fr;grid-template-rows:1fr 1fr 1fr;gap:6px}
  .dpad button{background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.02);border-radius:8px}
  .center{background:var(--accent);color:#042026;font-weight:700}
  .modal{position:fixed;left:0;top:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:rgba(2,6,23,0.6);z-index:50}
  .card{background:linear-gradient(180deg,#071327,#0e2230);padding:16px;border-radius:12px;max-width:420px;width:92%;box-sizing:border-box;border:1px solid rgba(255,255,255,0.04)}
  input[type=text]{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:var(--text);box-sizing:border-box}
  .row{display:flex;gap:8px;align-items:center}
  .hint{font-size:13px;color:#bfeee3}
  .small{font-size:12px;color:#a9c7c4}
  footer{padding:12px;color:#9fb6b0;font-size:13px;text-align:center}
  @media (min-width:800px){canvas{height:560px}}
</style>
</head>
<body>
  <div class="header container">
    <div class="title">Ù…ØºØ§Ù…Ø±Ø© ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„Ø¹Ù„ÙˆÙ… ğŸ”¬</div>
    <div class="row">
      <div class="badge" id="score">Ø§Ù„Ø¹Ù†Ø§ØµØ±: 0</div>
      <div class="badge" id="life">Ø·Ø§Ù‚Ø©: 3</div>
      <button class="button" id="codesBtn">Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯</button>
    </div>
  </div>

  <div class="container">
    <div class="game-area">
      <canvas id="gameCanvas" width="720" height="480"></canvas>
      <div class="controls" id="controls">
        <div class="dpad" id="dpad">
          <div></div><button data-dir="up">â–²</button><div></div>
          <button data-dir="left">â—€</button><button class="center">â—</button><button data-dir="right">â–¶</button>
          <div></div><button data-dir="down">â–¼</button><div></div>
        </div>
      </div>
    </div>
    <div style="height:8px"></div>
    <div class="ui-row">
      <div class="button" id="pauseBtn">Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª</div>
      <div class="badge small">Ù„Ù…Ø³ Ø§Ù„Ø£Ø³Ù‡Ù… Ù„Ù„ØªØ­Ø±ÙƒØŒ ÙˆØ§Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙˆØ§Ø¬Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©!</div>
    </div>
  </div>

  <footer>Ø¥Ù†Ù‡Ø§ Ù„Ø¹Ø¨Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© ØµØºÙŠØ±Ø© â€” Ø§Ø³ØªÙ…ØªØ¹ ÙˆØ§Ø³ØªÙƒØ´Ù! âœ¨</footer>

  <!-- Modal templates -->
  <div id="modalRoot" style="display:none"></div>

<script>
/*  Ù„Ø¹Ø¨Ø© Ø¨Ø³ÙŠØ·Ø©: Ø®Ø±ÙŠØ·Ø©ØŒ Ù„Ø§Ø¹Ø¨ØŒ Ø¹Ù†Ø§ØµØ± Ù„Ø¬Ù…Ø¹ØŒ Ø£Ø³Ø¦Ù„Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù„ØªÙ‚Ø§Ø·
    - ØªØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„Ù…Ø­Ù…ÙˆÙ„
    - Ø£ÙƒÙˆØ§Ø¯ Ø³Ù‡Ù„Ø© Ù„ÙØªØ­ Ù…Ø²Ø§ÙŠØ§
*/

// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
const GAME = {
  width: 900, height: 600, scaleToCanvas:true,
  playerSpeed: 120, // pixels per second
  initialLives: 3,
  codes: {
    'ATOM': { type:'hint', text: 'Ø§Ù„Ø°Ø±Ø© ØªØªÙƒÙˆÙ† Ù…Ù† Ø¨Ø±ÙˆØªÙˆÙ†Ø§Øª ÙˆÙ†ÙŠÙˆØªØ±ÙˆÙ†Ø§Øª ÙˆØ¥Ù„ÙƒØªØ±ÙˆÙ†Ø§Øª.' },
    'PLANET': { type:'openLevel', level: 2 },
    'ENERGY': { type:'life', amount: 1 }
  }
};

// Ø¨Ø¯Ù‘Ù„ Ø­Ø¬Ù… Ø§Ù„ÙƒØ§Ù†ÙØ³ Ù„ÙŠÙ†Ø§Ø³Ø¨ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let lastTime = 0;
let scale = 1;

function resizeCanvas(){
  const containerWidth = canvas.parentElement.clientWidth;
  const targetW = Math.min(900, containerWidth-2);
  scale = targetW / canvas.width;
  canvas.style.width = targetW + 'px';
  // height adjusts automatically by aspect ratio
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
let state = {
  running: true,
  score: 0,
  life: GAME.initialLives,
  player: { x:100, y:100, size:28 },
  dir: {x:0,y:0},
  items: [],
  level: 1,
  hintsUnlocked: []
};

// Ø¹Ù†Ø§ØµØ± Ø£Ø³Ø¦Ù„Ø© Ø¹Ù„Ù…ÙŠØ© Ø¨Ø³ÙŠØ·Ø©
const QUESTIONS = {
  1: [
    {q:'Ù…Ø§ Ù‡Ùˆ ÙƒÙˆÙƒØ¨Ù†Ø§ØŸ', options:['Ø§Ù„Ù…Ø±ÙŠØ®','Ø§Ù„Ø£Ø±Ø¶','Ø§Ù„Ù…Ø´ØªØ±ÙŠ'], a:1},
    {q:'Ù…Ø§ Ø£ØµØºØ± Ø¬Ø²Ø¡ ÙÙŠ Ø§Ù„Ù…Ø§Ø¯Ø©ØŸ', options:['Ø°Ø±Ø©','Ø®Ù„ÙŠØ©','Ù†ÙˆØ§Ø©'], a:0}
  ],
  2: [
    {q:'Ù…Ø§ Ù…ØµØ¯Ø± Ø§Ù„Ø·Ø§Ù‚Ø© ÙÙŠ Ø§Ù„Ù†Ø¨Ø§ØªØŸ', options:['Ø§Ù„Ù…Ø§Ø¡','Ø§Ù„Ø´Ù…Ø³','Ø§Ù„Ù‡ÙˆØ§Ø¡'], a:1},
    {q:'Ø£ÙŠÙ‡Ù… ØºØ§Ø² Ù†ØªÙ†ÙØ³ØŸ', options:['Ø§Ù„Ø£ÙƒØ³Ø¬ÙŠÙ†','Ø§Ù„Ù‡ÙŠÙ„ÙŠÙˆÙ…','Ø§Ù„Ù†ÙŠØªØ±ÙˆØ¬ÙŠÙ†'], a:0}
  ]
};

// Ø§Ù†Ø´Ø§Ø¡ Ø¹Ù†Ø§ØµØ± Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© ÙÙŠ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
function spawnItems(level=1){
  state.items = [];
  const count = 5 + level*1;
  for(let i=0;i<count;i++){
    state.items.push({
      id: 'item'+i,
      x: 60 + Math.random()*(canvas.width-120),
      y: 60 + Math.random()*(canvas.height-120),
      size: 20,
      collected: false,
      level: level
    });
  }
}
spawnItems(1);

// Ø±Ø³Ù… Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù„Ø¹Ø¨Ø©
function draw(){
  // Ø®Ù„ÙÙŠØ©
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // Ù†Ø¬ÙˆÙ… Ø¨Ø³ÙŠØ·Ø©
  for(let i=0;i<50;i++){
    ctx.fillStyle = 'rgba(255,255,255,0.03)';
    const sx = (i*47)%canvas.width;
    const sy = ((i*71)+30)%canvas.height;
    ctx.fillRect(sx,sy,1,1);
  }

  // Ø¹Ù†Ø§ØµØ±
  state.items.forEach(it=>{
    if(it.collected) return;
    ctx.fillStyle = '#f0d36a';
    ctx.beginPath();
    ctx.arc(it.x, it.y, it.size, 0, Math.PI*2);
    ctx.fill();
    ctx.fillStyle='#122c2b';
    ctx.font = '12px Tahoma';
    ctx.textAlign='center';
    ctx.fillText('Ø¹Ù†ØµØ±', it.x, it.y+4);
  });

  // Ø§Ù„Ù„Ø§Ø¹Ø¨
  ctx.fillStyle = '#2dd4bf';
  ctx.beginPath();
  ctx.arc(state.player.x, state.player.y, state.player.size, 0, Math.PI*2);
  ctx.fill();
  ctx.fillStyle='#042026';
  ctx.font='bold 12px Tahoma';
  ctx.textAlign='center';
  ctx.fillText('Ø£Ù†Øª', state.player.x, state.player.y+4);

  // ÙˆØ§Ø¬Ù‡Ø© ØµØºÙŠØ±Ø©
  ctx.fillStyle='rgba(0,0,0,0.25)';
  ctx.fillRect(8,8,160,44);
  ctx.fillStyle='#dffbf6';
  ctx.font='13px Tahoma';
  ctx.fillText(`Ø§Ù„Ù…Ø³ØªÙˆÙ‰: ${state.level}`, 20, 26);
  ctx.fillText(`Ø§Ù„Ø¹Ù†Ø§ØµØ±: ${state.score}`, 20, 44);
}

// ØªØ­Ø¯ÙŠØ« Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ dir
function update(dt){
  if(!state.running) return;
  const move = GAME.playerSpeed * dt;
  state.player.x += state.dir.x * move;
  state.player.y += state.dir.y * move;
  // Ø­Ø¯ÙˆØ¯
  state.player.x = Math.max(20, Math.min(canvas.width-20, state.player.x));
  state.player.y = Math.max(20, Math.min(canvas.height-20, state.player.y));

  // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ù„ØªÙ‚Ø§Ø·
  state.items.forEach(it=>{
    if(it.collected) return;
    const dx = state.player.x - it.x;
    const dy = state.player.y - it.y;
    const dist = Math.sqrt(dx*dx + dy*dy);
    if(dist < state.player.size + it.size - 4){
      it.collected = true;
      onCollect(it);
    }
  });
}

function onCollect(item){
  // Ù†Ù‚Ù‘Ù„ Ø¥Ù„Ù‰ Ù†Ø§ÙØ°Ø© Ø³Ø¤Ø§Ù„
  state.running = false;
  openQuestion(item.level);
}

// Ø£Ø³Ø¦Ù„Ø© ÙˆÙ…ÙˆØ¯Ø§Ù„ Ø¨Ø³ÙŠØ·
const modalRoot = document.getElementById('modalRoot');
function showModal(html){
  modalRoot.innerHTML = '';
  modalRoot.style.display = 'flex';
  const box = document.createElement('div');
  box.className='modal';
  box.innerHTML = `<div class="card">${html}</div>`;
  box.firstChild.addEventListener('click', e=>{ e.stopPropagation();});
  modalRoot.appendChild(box);
  modalRoot.onclick = ()=>{ /* Ù„Ø§ Ù†ØºÙ„Ù‚ Ø¨Ø§Ù„Ù†Ù‚Ø±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ© */ };
}
function closeModal(){
  modalRoot.innerHTML = '';
  modalRoot.style.display = 'none';
}

// Ø¹Ø±Ø¶ Ø³Ø¤Ø§Ù„ Ù„Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ
function openQuestion(level){
  const pool = QUESTIONS[level] || QUESTIONS[1];
  const q = pool[Math.floor(Math.random()*pool.length)];
  const optionsHtml = q.options.map((op,i)=>`<button class="button opt" data-i="${i}" style="margin:6px 0;width:100%">${op}</button>`).join('');
  const hintSection = state.hintsUnlocked.length ? `<div class="small hint">ØªÙ„Ù…ÙŠØ­Ø§Øª: ${state.hintsUnlocked.join(' â€¢ ')}</div>` : '';
  showModal(`
    <div>
      <h3 style="margin-top:0">${q.q}</h3>
      ${optionsHtml}
      ${hintSection}
      <div style="height:10px"></div>
      <div class="row"><div class="button" id="skipBtn">ØªØ®Ø·ÙŠ (-1 Ø·Ø§Ù‚Ø©)</div><div style="flex:1"></div><div class="button" id="closeBtn">Ø¥ØºÙ„Ø§Ù‚</div></div>
    </div>
  `);

  document.querySelectorAll('.opt').forEach(btn=>{
    btn.onclick = ()=>{
      const i = parseInt(btn.dataset.i);
      if(i === q.a){
        state.score += 1;
        updateHUD();
        closeModal();
        state.running = true;
        // Ø¥Ø°Ø§ Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù†ØªÙ‚Ù„ Ù…Ø³ØªÙˆÙ‰
        if(state.items.every(it=>it.collected)) {
          nextLevel();
        }
      } else {
        state.life -= 1;
        updateHUD();
        closeModal();
        state.running = true;
        if(state.life <= 0) gameOver();
      }
    };
  });

  document.getElementById('skipBtn').onclick = ()=>{
    state.life -= 1; updateHUD(); closeModal(); state.running = true;
    if(state.life <= 0) gameOver();
  };
  document.getElementById('closeBtn').onclick = ()=>{ closeModal(); state.running = true; };
}

// Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠ
function nextLevel(){
  state.level += 1;
  spawnItems(state.level);
  // Ù…ÙƒØ§ÙØ£Ø©: Ø·Ø§Ù‚Ø© ØµØºÙŠØ±Ø©
  state.life = Math.min(5, state.life + 1);
  updateHUD();
  // Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø© Ù‚ØµÙŠØ±Ø©
  showModal(`<div><h3>ØªÙ‡Ø§Ù†ÙŠÙ†Ø§!</h3><p>Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${state.level-1}. Ø§Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${state.level}.</p><div style="height:8px"></div><div class="row"><div class="button" id="okNext">Ø­Ø³Ù†Ø§Ù‹</div></div></div>`);
  document.getElementById('okNext').onclick = ()=>{ closeModal(); state.running=true; };
}

// Ø®Ø³Ø§Ø±Ø©
function gameOver(){
  showModal(`<div><h3>Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø·Ø§Ù‚Ø©</h3><p>Ù„Ù‚Ø¯ Ù†ÙØ¯Øª Ø·Ø§Ù‚ØªÙƒ. ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©ØŸ</p><div style="height:8px"></div><div class="row"><div class="button" id="restart">Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø©</div><div style="flex:1"></div><div class="button" id="closeGame">Ø®Ø±ÙˆØ¬</div></div></div>`);
  document.getElementById('restart').onclick = ()=>{ restart(); };
  document.getElementById('closeGame').onclick = ()=>{ closeModal(); state.running=false; };
}

// Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„
function restart(){
  state.score=0; state.life=GAME.initialLives; state.level=1;
  state.player.x=100; state.player.y=100;
  spawnItems(1); updateHUD(); closeModal(); state.running=true;
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª
function updateHUD(){
  document.getElementById('score').textContent = `Ø§Ù„Ø¹Ù†Ø§ØµØ±: ${state.score}`;
  document.getElementById('life').textContent = `Ø·Ø§Ù‚Ø©: ${state.life}`;
}

// Ø­Ù„Ù‚Ø© Ø§Ù„Ø±Ø³ÙˆÙ…
function loop(ts){
  if(!lastTime) lastTime = ts;
  const dt = Math.min(0.05,(ts-lastTime)/1000);
  update(dt);
  draw();
  lastTime = ts;
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

// ØªØ­ÙƒÙ…Ø§Øª Ø§Ù„Ù„Ù…Ø³ ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø±
document.querySelectorAll('#dpad button[data-dir]').forEach(btn=>{
  const dir = btn.dataset.dir;
  const map = {up:[0,-1],down:[0,1],left:[-1,0],right:[1,0]};
  btn.addEventListener('touchstart', e=>{ e.preventDefault(); state.dir.x = map[dir][0]; state.dir.y = map[dir][1]; });
  btn.addEventListener('touchend', e=>{ e.preventDefault(); state.dir.x = 0; state.dir.y = 0; });
  btn.addEventListener('mousedown', e=>{ state.dir.x = map[dir][0]; state.dir.y = map[dir][1]; });
  btn.addEventListener('mouseup', e=>{ state.dir.x = 0; state.dir.y = 0; });
});

// Ø¯Ø¹Ù… Ø§Ù„Ø³Ø­Ø¨ Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„: Ù„Ù…Ø³ ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù† Ù„ÙŠØ¨Ù‚Ù‰ ÙŠØªØ¬Ù‡ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù†Ø­Ùˆ Ø§Ù„Ù„Ù…Ø³Ø©
canvas.addEventListener('touchstart', e=>{
  const t = e.touches[0];
  const r = canvas.getBoundingClientRect();
  const x = (t.clientX - r.left) * (canvas.width / r.width);
  const y = (t.clientY - r.top) * (canvas.height / r.height);
  const dx = x - state.player.x, dy = y - state.player.y;
  const len = Math.hypot(dx,dy) || 1;
  state.dir.x = dx/len; state.dir.y = dy/len;
});
canvas.addEventListener('touchmove', e=>{
  const t = e.touches[0];
  const r = canvas.getBoundingClientRect();
  const x = (t.clientX - r.left) * (canvas.width / r.width);
  const y = (t.clientY - r.top) * (canvas.height / r.height);
  const dx = x - state.player.x, dy = y - state.player.y;
  const len = Math.hypot(dx,dy) || 1;
  state.dir.x = dx/len; state.dir.y = dy/len;
});
canvas.addEventListener('touchend', e=>{ state.dir.x=0; state.dir.y=0; });

// Ø£Ø²Ø±Ø§Ø± UI
document.getElementById('pauseBtn').onclick = ()=>{
  state.running = !state.running;
  document.getElementById('pauseBtn').textContent = state.running ? 'Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª' : 'Ø§Ø³ØªØ¦Ù†Ø§Ù';
};
document.getElementById('codesBtn').onclick = ()=>{ openCodeModal(); };

// Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯
function openCodeModal(){
  showModal(`
    <div>
      <h3>Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ÙØªØ­ Ø£Ùˆ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©</h3>
      <input id="codeInput" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙˆØ¯ Ù‡Ù†Ø§ (Ù…Ø«Ø§Ù„: ATOM)"/>
      <div style="height:8px"></div>
      <div class="row">
        <div class="button" id="applyCode">ØªØ·Ø¨ÙŠÙ‚</div>
        <div style="flex:1"></div>
        <div class="button" id="closeCode">Ø¥Ù„ØºØ§Ø¡</div>
      </div>
      <div style="height:8px"></div>
      <div class="small hint">Ø£Ù…Ø«Ù„Ø©: ATOM - PLANET - ENERGY</div>
    </div>
  `);
  document.getElementById('applyCode').onclick = ()=>{
    const val = document.getElementById('codeInput').value.trim().toUpperCase();
    applyCode(val);
  };
  document.getElementById('closeCode').onclick = ()=>{ closeModal(); };
}

// ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙƒÙˆØ¯
function applyCode(code){
  if(!code){ alert('Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯Ø§Ù‹'); return; }
  const map = GAME.codes;
  if(map[code]){
    const effect = map[code];
    if(effect.type === 'hint'){
      state.hintsUnlocked.push(effect.text);
      showModal(`<div><h3>ØªÙ… ØªÙØ¹ÙŠÙ„ ØªÙ„Ù…ÙŠØ­</h3><p class="hint">${effect.text}</p><div style="height:8px"></div><div class="row"><div class="button" id="okc">Ø­Ø³Ù†Ø§Ù‹</div></div></div>`);
      document.getElementById('okc').onclick = ()=>{ closeModal(); state.running=true; };
    } else if(effect.type === 'openLevel'){
      state.level = Math.max(state.level, effect.level);
      spawnItems(state.level);
      updateHUD();
      showModal(`<div><h3>ØªÙ… ÙØªØ­ Ù…Ø³ØªÙˆÙ‰ ${effect.level}</h3><p>Ù„Ù‚Ø¯ ØªÙ… ÙØªØ­ Ù…Ø³ØªÙˆÙ‰ Ø¥Ø¶Ø§ÙÙŠ.</p><div style="height:8px"></div><div class="row"><div class="button" id="okc2">Ø­Ø³Ù†Ø§Ù‹</div></div></div>`);
      document.getElementById('okc2').onclick = ()=>{ closeModal(); state.running=true; };
    } else if(effect.type === 'life'){
      state.life += effect.amount;
      updateHUD();
      showModal(`<div><h3>Ø·Ø§Ù‚Ø© Ù…Ø¹Ø§Ø¯Ø©</h3><p>Ø£Ø¶ÙŠÙØª ${effect.amount} Ø·Ø§Ù‚Ø©.</p><div style="height:8px"></div><div class="row"><div class="button" id="okc3">Ø­Ø³Ù†Ø§Ù‹</div></div></div>`);
      document.getElementById('okc3').onclick = ()=>{ closeModal(); };
    }
  } else {
    showModal(`<div><h3>ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­</h3><p>Ø­Ø§ÙˆÙ„ ÙƒÙˆØ¯Ù‹Ø§ Ø¢Ø®Ø± Ø£Ùˆ ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒØªØ§Ø¨Ø©.</p><div style="height:8px"></div><div class="row"><div class="button" id="badOk">Ø­Ø³Ù†Ø§Ù‹</div></div></div>`);
    document.getElementById('badOk').onclick = ()=>{ closeModal(); };
  }
}

// ØªØ­Ø¶ÙŠØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
updateHUD();

</script>
</body>
</html>